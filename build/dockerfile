# docker build -t dleongsh/speech-explorer:3.0.0dev .
FROM python:3.10.13-slim-bookworm

ENV TZ=Asia/Singapore
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# Install libsndfile1 (linux soundfile package)
RUN apt-get update && apt-get install -y libsndfile1 ffmpeg sox wget git \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get clean && rm -rf /tmp/* /var/tmp/* /var/lib/apt/lists/* && apt-get -y autoremove \
    && rm -rf /var/cache/apt/archives/

# Keeps Python from generating .pyc files in the container
ENV PYTHONDONTWRITEBYTECODE 1

# Turns off buffering for easier container logging
ENV PYTHONUNBUFFERED 1

ADD requirements.txt .
RUN python -m pip install --upgrade --no-cache-dir pip wheel \
    && python -m pip install --no-cache-dir Cython==3.0.6 \
    && python -m pip install --no-cache-dir -r requirements.txt

#docker container starts with bash
WORKDIR /explorer
RUN ["bash"]